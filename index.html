<!DOCTYPE html>
<html>
<title>W3.CSS Template</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
body, h1,h2,h3,h4,h5,h6 {font-family: "Montserrat", sans-serif}
.w3-row-padding img {margin-bottom: 12px}
/* Set the width of the sidebar to 120px */
.w3-sidebar {width: 120px;background: rgb(148, 146, 146);}
/* Add a left margin to the "page content" that matches the width of the sidebar (120px) */
#main {margin-left: 120px}
/* Remove margins from "page content" on small screens */
@media only screen and (max-width: 600px) {#main {margin-left: 0}}
</style>
<head>

    <script>
    function reload(){
      location.reload();
    }

  function getRawInfo() {
  return fetch('https://sheltered-hollows-60821.herokuapp.com')
    .then(function(response) {
      return response.text();
    })
    .then(function(data) {
      return data;
    })
}



  async function getData(){
    const rawData = await this.getRawInfo();
    const result2 = rawData.replaceAll("\\n","").replaceAll("\"blackriver\":\"","").replaceAll("\",\"grandport\":\"","").replaceAll("\",\"moka\":\"","").replaceAll("\",\"plainewilhems\":\"","")
   .replaceAll("\",\"portlouis\":\"","").replaceAll("\",\"rivieredurempart\":\"","").replaceAll("\",\"savanne\":\"","").replaceAll("\",\"rodrigues\":\"","").replaceAll("\",\"flacq\":\"","")
   .replaceAll("\",\"pamplemousses\":\"","");
   const result3 = result2.replaceAll("<table","<table border=\"1\"")
                          .replaceAll("table>\"","table>")
                          .replaceAll("\\u00e0","à")
                          .replaceAll("\\u00e8","è")
                          .replaceAll("\\u00e9","é")
                          .replaceAll("\\u00e0","à")
                          .replaceAll("\\u00e2","â>")
                          .replaceAll("\\u2019","'");
    const timestamp = new Date();
    const final_result = "MIME-Version: 1.0\r\nTo: Replace With recipients <email@domain.com>\r\nSubject: Coupures/Power Outages\r\nX-Unsent: 1\r\nContent-Type: text/html; charset=\"utf-8\"\r\n\r\n" + 
    "<html><head><meta charset='UTF-8' /></head><body> <p>Hello all,</p> Today's List: <br> "+result3+"</body></p><p>Have a nice day ahead!<p> <br><p> Generated On: "+timestamp +"</p></html>";
 
    var data = new Blob([final_result], {type: 'text/plain'});
    var textFile = window.URL.createObjectURL(data);

    var link = document.getElementById('downloadlink');
    link.href = textFile;
    link.style.display = 'block';
  }

</script>
</head>

<body class="w3-white" onload="getData();">

  <!-- Icon Bar (Sidebar - hidden on small screens) -->
<nav class="w3-sidebar w3-bar-block w3-small w3-hide-small w3-center">
  <!-- Avatar image in top left corner -->

  <a href="javascript:reload();" class="w3-bar-item w3-button w3-padding-large w3-white" >
    <i class="fa fa-home w3-xxlarge"></i>
    <p>Home</p>
  </a>
  <a  class="w3-bar-item w3-button w3-padding-large w3-hover-white" download="power_cut_mail.eml" id="downloadlink"  >
    <i class="fa fa-envelope  w3-xxlarge"></i>
    <p>Email Powercut!</p>
  </a>
  <a href="https://github.com/krit-space/powercut" target="_blank" class="w3-bar-item w3-button w3-padding-large w3-hover-white" >
    <i class="fa fa-github w3-xxlarge"></i>
    <p>Github</p>
  </a>
  <a href="https://www.linkedin.com/in/kritesh-sunghoon-286ab6128/" target="_blank" class="w3-bar-item w3-button w3-padding-large w3-hover-white" >
    <i class="fa fa-linkedin  w3-xxlarge"></i>
    <p>LinkedIn</p>
  </a>

</nav>
<!-- Page Content -->
<div class="w3-padding-large" id="main">
    <iframe width="100%" height="900" id= "report" src="https://app.powerbi.com/view?r=eyJrIjoiZjE1ODRhMWYtNmY3NC00M2QzLThkNjctMDljNTg0NDY3OWEwIiwidCI6IjA3OTFmMDE5LTRkYzItNDU2Mi1iMWY1LTAzOTk4ZjFmOGNhNSJ9&pageName=ReportSection"
     frameborder="0" allowFullScreen="true"></iframe>
</div>
</body>
</html>
